<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Happy 3 Months 纹纹!!!</title>
  <meta name="description" content="A little love page for our 3-monthsary ❤️" />

  <!-- Fancy font for subtext -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#0b1d39;            /* dark navy */
      --text:#eaf2ff;          /* soft white */
      --accent:#ff3355;        /* heart red */
      --glow: 0 0 20px rgba(255,255,255,.25);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:var(--bg);
      color:var(--text); font-family:Poppins,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,sans-serif;
      overflow:hidden;
    }

    /* Floating clouds */
    .clouds{position:fixed; inset:0; pointer-events:none; z-index:0}
    .cloud{position:absolute; filter:drop-shadow(0 8px 10px rgba(0,0,0,.25)); opacity:.9}
    @keyframes driftL{ from{transform:translateX(110vw)} to{transform:translateX(-120vw)} }
    @keyframes driftR{ from{transform:translateX(-120vw)} to{transform:translateX(110vw)} }

    /* Center content */
    .wrap{position:relative; z-index:2; display:grid; place-items:center; min-height:100vh; text-align:center; padding:4rem 1.25rem}
    .stack{display:flex; flex-direction:column; align-items:center; gap:0}  

    /* Beating heart (bigger & right above heading) */
    .heart{width:220px; height:200px; margin-bottom:6px; position:relative; display:inline-block}
    .heart:before, .heart:after{
      content:""; position:absolute; width:110px; height:160px; background:var(--accent);
      top:0; border-radius:110px 110px 0 0; box-shadow: var(--glow);
    }
    .heart:before{ left:110px; transform:rotate(-45deg); transform-origin:0 100%; }
    .heart:after{ left:0; transform:rotate(45deg); transform-origin:100% 100%; }
    .heart{ animation: beat 2.2s ease-in-out infinite; filter: drop-shadow(0 0 18px rgba(255, 51, 85, .4)); }
    @keyframes beat{ 0%,20%,40%,60%,80%,100%{transform:scale(1)} 10%,30%,50%,70%,90%{transform:scale(1.12)} }

    h1{font-weight:800; letter-spacing:.3px; margin:0; line-height:1.05; text-shadow:0 6px 18px rgba(0,0,0,.35)}
    .sub{font-family:'Great Vibes', cursive; font-size:2rem; letter-spacing:.2px; margin:10px 0 0; line-height:1.05;}

    /* Fireworks canvas */
    #fx{position:fixed; inset:0; z-index:1; pointer-events:none}

    /* Tap-to-start overlay (for autoplay policies) */
    .gate{  position:fixed; inset:0; z-index:3; background:radial-gradient(1200px 600px at 50% 30%, rgba(255,255,255,.08), transparent 60%), var(--bg); display:grid; place-items:center; padding:2rem; transition: opacity .45s ease;  opacity:1; }
    .gate-card{ text-align:center; background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.15); padding:1.2rem 1.4rem; border-radius:18px; max-width:520px; box-shadow:0 12px 40px rgba(0,0,0,.35); }
    .btn{ margin-top:1rem; padding:.8rem 1.1rem; border-radius:999px; border:none; background:#ffffff; color:#0b1430; font-weight:700; cursor:pointer; transition:transform .08s ease; box-shadow:0 10px 24px rgba(0,0,0,.25); }
    .btn:active{transform:translateY(1px) scale(.99)}

    /* Small screens tweaks */
    @media (max-width:480px){ .heart{width:180px; height:160px} h1{font-size:1.35rem} .sub{font-size:1.6rem} }
    /* --- Size tweaks for bigger heart --- */
    .heart{width:320px; height:280px}
    .heart:before, .heart:after{width:160px; height:220px; border-radius:160px 160px 0 0}
    .heart:before{left:160px}
    /* SVG heart (crisp, non-distorted) */
    .heart-svg{width:340px; height:auto; margin:0; filter: drop-shadow(0 0 22px rgba(255, 51, 85, .45)); animation: beat 2.2s ease-in-out infinite;}
    /* emergency hide class for the gate */
    .gate.hidden{display:none !important; opacity:0 !important; pointer-events:none !important}
  </style>
</head>
<body>
  <!-- Clouds layer -->
  <div class="clouds" id="clouds"></div>

  <!-- Fireworks canvas -->
  <canvas id="fx"></canvas>

  <!-- Centered content -->
  <main class="wrap" aria-live="polite">
    <div class="stack">
      <svg class="heart-svg" viewBox="0 0 100 90" aria-hidden="true" role="img">
        <defs>
          <linearGradient id="hg" x1="0" y1="0" x2="1" y2="1">
            <stop offset="0%" stop-color="#ff4b6e"/>
            <stop offset="100%" stop-color="#ff2e54"/>
          </linearGradient>
        </defs>
        <path fill="url(#hg)" d="M50 86 L12 48 A22 22 0 1 1 50 20 A22 22 0 1 1 88 48 Z"/>
      </svg>
      <h1>Happy 3 Months 纹纹!!!</h1>
      <p class="sub">Let’s keep growing together ❤️❤️❤️</p>
    </div>
  </main>

  <!-- Background music (replace src with your own MP3) -->
  <audio id="bgm" src="romantic-flight-trimmed.mp3" loop preload="auto"></audio>
  <!-- Optional custom firework pop sample; set USE_POP_SAMPLE=true in the script and add pop.mp3 next to this file -->
  <audio id="popSfx" src="pop.mp3" preload="auto"></audio>
  <!-- Rocket SFX (user-provided). Place these files next to index.html -->
  <audio id="whistleSfx" src="fireworks-whistlewav-14541.mp3" preload="auto"></audio>
  <audio id="blastSfx" src="fireworkblast-106275.mp3" preload="auto"></audio>

  <!-- Start gate to enable audio -->
  <div class="gate" id="gate" role="dialog" aria-modal="true">
    <div class="gate-card">
      <h2 style="margin:.4rem 0 .25rem">Press start to see my love for you hehe ✨</h2>
      <p style="opacity:.9; margin:0 .25rem 0">Make sure your volume is on babyyyyyy</p>
      <button class="btn" id="go" type="button" onclick="try{document.getElementById('gate').style.display='none';}catch(e){}; if(window.handleStart){handleStart(event);} return false;">Start</button>
    </div>
  </div>

  <script>
(function () {
  const cloudsEl = document.getElementById('clouds');
  const canvas   = document.getElementById('fx');
  const ctx      = canvas.getContext('2d');
  const gate     = document.getElementById('gate');
  const btn      = document.getElementById('go');
  const bgm      = document.getElementById('bgm');

  // ---- Canvas sizing ----
  let DPR=1, W=0, H=0;
  function size(){
    DPR = Math.min(window.devicePixelRatio || 1, 1.5);
    W = canvas.width  = Math.floor(innerWidth  * DPR);
    H = canvas.height = Math.floor(innerHeight * DPR);
    canvas.style.width  = innerWidth +'px';
    canvas.style.height = innerHeight+'px';
  }
  addEventListener('resize', size); size();

  // ---- Clouds ----
  function cloudSVG(w=260,h=140,fill='#eef'){
    return `<svg xmlns='http://www.w3.org/2000/svg' width='${w}' height='${h}' viewBox='0 0 260 140'>
      <defs><linearGradient id='g' x1='0' y1='0' x2='0' y2='1'><stop offset='0%' stop-color='${fill}' stop-opacity='.96'/><stop offset='100%' stop-color='${fill}' stop-opacity='.78'/></linearGradient></defs>
      <g fill='url(#g)'><ellipse cx='70' cy='80' rx='55' ry='32'/><ellipse cx='130' cy='65' rx='70' ry='46'/><ellipse cx='180' cy='86' rx='50' ry='30'/><ellipse cx='110' cy='95' rx='80' ry='34'/></g></svg>`;
  }
  function spawnCloud(y,scale,dur,dir){
    const el=document.createElement('div'); el.className='cloud';
    const hue=190+Math.random()*130, sat=45+Math.random()*40, light=82+Math.random()*12;
    const tint=`hsl(${hue|0}, ${sat|0}%, ${light|0}%)`;
    const url='data:image/svg+xml;base64,'+btoa(cloudSVG(260,140,tint));
    el.style.background=`url(${url}) no-repeat 0 0 / contain`;
    el.style.width=320*scale+'px'; el.style.height=180*scale+'px'; el.style.top=y+'vh';
    el.style.left=(dir==='L'?'auto':'-30vw'); el.style.right=(dir==='L'?'-30vw':'auto');
    el.style.opacity=(0.55+Math.random()*0.35).toFixed(2);
    el.style.animation=`${dir==='L'?'driftL':'driftR'} ${dur}s linear infinite`;
    el.style.animationDelay=(-Math.random()*dur).toFixed(2)+'s';
    cloudsEl && cloudsEl.appendChild(el);
  }
  (function initClouds(){ if(!cloudsEl) return; cloudsEl.innerHTML=''; for(let i=0;i<14;i++){ spawnCloud(2+Math.random()*86, .8+Math.random()*1.6, 60+Math.random()*80, Math.random()>.5?'L':'R'); } })();

  // ---- Fireworks ----
  const GRAV=0.08, DRAG=0.01;
  const rnd=(a,b)=>a+Math.random()*(b-a);

  const rockets=[], bursts=[];
  let particleTotal = 0;
  const MAX_PARTICLES = 3200; // cap for performance

  class Rocket{
    constructor(x,tx,ty){
      this.x=x; this.y=innerHeight+12;
      this.vx=(tx-x)/rnd(40,60);
      this.vy=-rnd(9.5,12.5);
      this.ty=ty; this.life=220;
      if (window.__sfxReady) playWhistle();
    }
    step(){
      this.vy += GRAV*0.06;
      this.x  += this.vx;
      this.y  += this.vy;
      this.life--;
      const close    = this.y <= this.ty+6;
      const falling  = this.vy > -1.0 && this.y <= this.ty+60;
      if (close || falling || this.life<=0){ boom(this.x, this.y); return false; }
      return true;
    }
    draw(){
      ctx.save();
      ctx.globalCompositeOperation='lighter';
      ctx.beginPath(); ctx.fillStyle='rgba(255,255,255,.9)';
      ctx.arc(this.x*DPR,this.y*DPR,2.1*DPR,0,Math.PI*2); ctx.fill();
      ctx.beginPath(); ctx.strokeStyle='rgba(255,210,120,.6)'; ctx.lineWidth=2*DPR;
      ctx.moveTo(this.x*DPR,(this.y+10)*DPR); ctx.lineTo(this.x*DPR,(this.y+24)*DPR); ctx.stroke();
      ctx.restore();
    }
  }

  class Particle{
    constructor(x,y,col,vx=0,vy=0,opts={}){
      this.x=x; this.y=y; this.c=col;
      this.vx=vx; this.vy=vy;
      this.sz=rnd(1.6,3.0);
      this.al=1; this.life=rnd(110,160); this.age=0;
      this.hold=opts.hold??18;
      this.dragEarly=opts.dragEarly??0.008; this.dragLate=opts.dragLate??DRAG;
      this.gEarly=opts.gEarly??(GRAV*0.06); this.gLate=opts.gLate??(GRAV*0.22);
      this.decay=opts.decay??0.985;
    }
    step(){
      this.age++;
      const early=this.age<this.hold;
      const drag = early?this.dragEarly:this.dragLate;
      const g    = early?this.gEarly:this.gLate;
      this.vx*=(1-drag);
      this.vy*=(1-drag);
      this.vy+=g;
      this.x+=this.vx; this.y+=this.vy;
      if (!early) this.al*=this.decay;
      this.life--;
    }
    draw(){
      ctx.beginPath();
      ctx.fillStyle=this.c.replace('ALPHA', Math.max(0,Math.min(1,this.al)).toFixed(2));
      ctx.arc(this.x*DPR,this.y*DPR,this.sz*DPR,0,Math.PI*2);
      ctx.fill();
    }
  }

  function heartXY(t, R){
    const hx = 16*Math.pow(Math.sin(t),3);
    const hy = 13*Math.cos(t) - 5*Math.cos(2*t) - 2*Math.cos(3*t) - Math.cos(4*t);
    return { x:(hx/16)*R, y:(-hy/17)*R };
  }

  function boom(x,y){
    const parts=[];
    const HEART_SIZE=rnd(60,80);
    // Random color palettes: gold, red, purple
    const palettes = [
      {
        name:'gold',
        heart:(a)=>`hsla(50, 100%, 60%, ${a})`,
        halo:(a)=>`hsla(55, 100%, ${75+rnd(-4,4)}%, ${a})`,
        ember:(a)=>`hsla(40, 100%, 55%, ${a})`
      },
      {
        name:'red',
        heart:(a)=>`hsla(${rnd(0,10).toFixed(0)}, 100%, 60%, ${a})`,
        halo:(a)=>`hsla(${rnd(15,30).toFixed(0)}, 100%, 65%, ${a})`,
        ember:(a)=>`hsla(25, 100%, 56%, ${a})`
      },
      {
        name:'purple',
        heart:(a)=>`hsla(280, 100%, 70%, ${a})`,
        halo:(a)=>`hsla(300, 100%, 85%, ${a})`,
        ember:(a)=>`hsla(40, 100%, 55%, ${a})`
      },
      {
        name:'pink',
        heart:(a)=>`hsla(330, 100%, 70%, ${a})`,
        halo:(a)=>`hsla(340, 100%, 85%, ${a})`,
        ember:(a)=>`hsla(32, 100%, 58%, ${a})`
      }
    ];
    const pal = palettes[(Math.random()*palettes.length)|0];
    const heartColor = pal.heart;
    const haloColor  = pal.halo;
    const emberColor = pal.ember; // golden embers

    // Heart outline — push outward immediately toward the perimeter
    const outlineN=220;
    for(let i=0;i<outlineN;i++){
      const t=(i/outlineN)*Math.PI*2;
      const p=heartXY(t,HEART_SIZE);
      const px=x+p.x, py=y+p.y;                 // spawn ON the heart (no center dot)
      const rad=Math.hypot(p.x,p.y)||1;         // outward unit vector
      const ux=p.x/rad, uy=p.y/rad;
      const sp=rnd(0.12,0.24);                  // gentle outward drift
      const vx=ux*sp + rnd(-0.04,0.04);
      const vy=uy*sp + rnd(-0.04,0.04);
      parts.push(new Particle(px,py,heartColor('ALPHA'),vx,vy,{hold:20,gEarly:GRAV*0.02,gLate:GRAV*0.24,dragEarly:0.008,decay:0.986}));
    }

    // Heart fill — slightly slower for density
    const fillN=160;
    for(let i=0;i<fillN;i++){
      const t=rnd(0,Math.PI*2); const R=HEART_SIZE*rnd(0.4,1.0);
      const p=heartXY(t,R);
      const px=x+p.x + rnd(-0.6,0.6), py=y+p.y + rnd(-0.6,0.6);
      const rad=Math.hypot(p.x,p.y)||1; const ux=p.x/rad, uy=p.y/rad;
      const sp=rnd(0.10,0.18);
      const vx=ux*sp + rnd(-0.03,0.03);
      const vy=uy*sp + rnd(-0.03,0.03);
      parts.push(new Particle(px,py,heartColor('ALPHA'),vx,vy,{hold:18,gEarly:GRAV*0.02,gLate:GRAV*0.22,dragEarly:0.008,decay:0.986}));
    }

    // Halo sparkles
    const haloN=120; const minR=HEART_SIZE*1.2, maxR=HEART_SIZE*1.9;
    for(let i=0;i<haloN;i++){
      const a=rnd(0,Math.PI*2), r=rnd(minR,maxR);
      const px=x+Math.cos(a)*r, py=y+Math.sin(a)*r;
      const sp=rnd(0.8,1.8);
      const vx=Math.cos(a)*sp + rnd(-0.12,0.12);
      const vy=Math.sin(a)*sp + rnd(-0.12,0.12) - rnd(0,0.12);
      parts.push(new Particle(px,py,haloColor('ALPHA'),vx,vy,{hold:8,gEarly:GRAV*0.06,gLate:GRAV*0.26,dragEarly:0.010,decay:0.978}));
    }

    // Falling embers (from lower half)
    const emberN=90;
    for(let i=0;i<emberN;i++){
      const t=rnd(Math.PI*0.15, Math.PI*0.85);
      const R=HEART_SIZE*rnd(0.55,1.0);
      const p=heartXY(t,R);
      const vx=rnd(-0.08,0.08), vy=rnd(0.06,0.22);
      parts.push(new Particle(x+p.x*0.1, y+p.y*0.1, emberColor('ALPHA'), vx, vy,{hold:14,gEarly:GRAV*0.05,gLate:GRAV*0.12,dragEarly:0.010,decay:0.982}));
    }
    // --- remove any accidental center clump & nudge slow particles outward ---
    for (let i = parts.length - 1; i >= 0; i--) {
      const dx = parts[i].x - x, dy = parts[i].y - y;
      const r = Math.hypot(dx, dy);
      if (r < 14) { parts.splice(i, 1); continue; }
      const vmag = Math.hypot(parts[i].vx, parts[i].vy);
      if (vmag < 0.02) {
        const ux = dx / (r || 1), uy = dy / (r || 1);
        const boost = 0.08;
        parts[i].vx += ux * boost; parts[i].vy += uy * boost;
      }
    }

    // particle budget guard
    if (particleTotal >= MAX_PARTICLES) return;
    if (particleTotal + parts.length > MAX_PARTICLES) {
      parts.length = Math.max(0, MAX_PARTICLES - particleTotal);
    }
    bursts.push(parts);
    particleTotal += parts.length;
    if (window.__sfxReady) playBlast();
  }

  function tick(){
    ctx.clearRect(0,0,W,H);
    ctx.globalCompositeOperation='lighter';
    for (let i = rockets.length - 1; i >= 0; i--) {
      // Step first to avoid drawing the rocket head on the boom frame (removes center dot)
      const alive = rockets[i].step();
      if (!alive) { rockets.splice(i, 1); continue; }
      rockets[i].draw();
    }
    for(let i=bursts.length-1;i>=0;i--){
      const b=bursts[i];
      for(let j=b.length-1;j>=0;j--){
        const p=b[j]; p.step(); p.draw();
        if (p.life<=0 || p.al<=0) { b.splice(j,1); particleTotal--; }
      }
      if (b.length===0) bursts.splice(i,1);
    }
    ctx.globalCompositeOperation='source-over';
    requestAnimationFrame(tick);
  }
  tick();

  function launch(){
    if (particleTotal > MAX_PARTICLES*0.9) { // if too busy, spawn fewer
      const sx=rnd(innerWidth*0.10, innerWidth*0.90);
      const tx=sx+rnd(-60,60);
      const ty=rnd(innerHeight*0.22, innerHeight*0.82);
      rockets.push(new Rocket(sx,tx,ty));
      return;
    }
    // sometimes 1–3 rockets in a burst, with small stagger and wider target heights
    const count = Math.random() < 0.55 ? 1 : (Math.random() < 0.5 ? 2 : 3);
    for (let i=0;i<count;i++){
      const sx = rnd(innerWidth*0.10, innerWidth*0.90);
      const tx = sx + rnd(-60,60);
      const ty = rnd(innerHeight*0.22, innerHeight*0.82); // allow lower explosions too
      const delay = i===0 ? 0 : rnd(80, 320);
      setTimeout(()=>{ rockets.push(new Rocket(sx,tx,ty)); }, delay);
    }
  }
  setInterval(launch, 950);

  // ---- Audio (WebAudio w/ fallback) ----
  let actx, masterGain, whistleBuf=null, blastBuf=null, whistleGain=null, blastGain=null;
  function ensureAudio(){
    if(!actx){
      actx = new (window.AudioContext||window.webkitAudioContext)();
      masterGain = actx.createGain(); masterGain.gain.value = 0.12; masterGain.connect(actx.destination);
      whistleGain = actx.createGain(); whistleGain.gain.value = 0.05; whistleGain.connect(masterGain);
      blastGain   = actx.createGain(); blastGain.gain.value   = 0.035; blastGain.connect(masterGain);
    }
  }
  async function decode(url){ const res=await fetch(url); const buf=await res.arrayBuffer(); return await actx.decodeAudioData(buf); }
  async function loadSfx(){ try{ if(!whistleBuf) whistleBuf = await decode('fireworks-whistlewav-14541.mp3'); if(!blastBuf) blastBuf = await decode('fireworkblast-106275.mp3'); }catch(e){ console.warn(e); } }
  function playWhistle(){ if(whistleBuf&&actx){ const s=actx.createBufferSource(); s.buffer=whistleBuf; s.playbackRate.value=1+Math.random()*0.1; s.connect(whistleGain); s.start(); return; }
    const el=document.getElementById('whistleSfx'); if(!el) return; const c=el.cloneNode(true); c.volume=0.06; c.playbackRate=1+Math.random()*0.1; c.play().catch(()=>{}); }
  function playBlast(){ if(blastBuf&&actx){ const s=actx.createBufferSource(); s.buffer=blastBuf; s.playbackRate.value=0.95; s.connect(blastGain); s.start(); return; }
    const el=document.getElementById('blastSfx'); if(!el) return; const c=el.cloneNode(true); c.volume=0.04; c.playbackRate=0.95; c.play().catch(()=>{}); }

  async function start(){
    if (gate) gate.style.display='none';
    window.__sfxReady = true; // allow early whistles during decode
    try{
      ensureAudio();
      if (actx.state==='suspended') await actx.resume();
      loadSfx();                // don’t block
      try{ await bgm.play(); }catch(_){}
    }catch(_){}
  }
  if (btn)  btn.addEventListener('click', start, {once:true});
  if (gate) gate.addEventListener('click', (e)=>{ if (e.target===gate) start(); }, {once:true});
})();
</script>
</body>
</html>
